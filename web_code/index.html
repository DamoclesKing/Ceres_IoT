<!DOCTYPE html>
<html lang="es">
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mqtt/4.2.6/mqtt.js"></script>
    <!-- -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.js"></script>
    <meta charset="utf-8" />
    <link
      href="https://fonts.googleapis.com/css?family=Poppins:100,200,300"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="css/styles.css" />
    <script src="server/sketch.js"></script>
    <title></title>
  </head>

  <body>
    <div class="wrapper">
      <div class="navigation">
        <ul>
            <li><a href="#banner" onclick="toggleMenu()">Hogar</a></li>
            <li><a href="#about" onclick="toggleMenu()">Agricultura</a></li>
            <!-- <li><a href="#services" onclick="toggleMenu()"></a></li>
            <li><a href="#project" onclick="toggleMenu()">Proyectos</a></li>
            <li><a href="#contact" onclick="toggleMenu()">Contacto</a></li> -->
        </ul>
        <div class="themeSwitch"></div>
    </div>
      <main>
        <h1>Monitoreo de ESP32/uwu</h1>
        <p>Visualización de estadísticas globales</p>

        <hr />

        <h2 class="loading">Esperando respuesta de la API...</h2>

        <section class="cols-2">
          <figure>
            <p>Humedad de la Tierra</p>
            <h3>----------</h3>
            <canvas id="humSoil"></canvas>
          </figure>

          <figure>
            <p>Nivel Tanque de Agua</p>
            <h3>----------</h3>
            <canvas id=""></canvas>
          </figure>
        </section>

        <section class="cols-1">
          <figure>
            <p>Gráfico lineal</p>
            <h3>Grafico de Temperatura</h3>
            <canvas id="tempGrafic"></canvas>
          </figure>
        </section>

        <section class="cols-3">
          <figure>
            <p>Nivel de Agua</p>
            <h3>Tanque de Agua Principal</h3>
            <canvas id="cylGauge1"></canvas>
          </figure>

          <figure>
            <p>Nivel de Agua</p>
            <h3>Tanque de Agua de Reserva</h3>
            <canvas id="cylGauge2"></canvas>
          </figure>

          <figure>
            <p>Panel de Control</p>
            <h3>Control de Llenado</h3>
            <label class="switch">
              <input type="checkbox"  onclick="save()">
              <span class="slider round"></span>
            </label>

          </figure>
        </section>
      </main>
    </div>

    <!-- ChartJS 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>-->

    <!-- Styles for charts -->
    <script src="js/chartStyles.js"></script>
    <script src="js/paint.js"></script>

    <!-- DCharts development
    <script src="js/script.js"></script> -->
  </body>

  <!-- <script> 
  var client = mqtt.connect('wss://test.mosquitto.org:8081');
//Si lo usas en hosting para usar encriptado https
// var client = mqtt.connect("wss://test.mosquitto.org:8081/mqtts")

function EventoConectar() {
  console.log("Conectado a MQTT");
  client.subscribe("esp/dht/temperature/#", function (err) {
    if (!err) {
      //client.publish("ALSW/Temperatura", "30");
      document.body.classList.add('running')
      console.log("good");
    }
  });
}
let counters = 0;
function EventoMensaje(topic, message) {
  if (topic == "esp32/test") {
    console.log("La Temperatura es " + message.toString());
  }
  console.log(topic + " - " + message.toString());

  myChart.data.labels.push(counters)
  myChart.data.datasets.forEach(dataset => {
    dataset.data.push(message.toString())
    
  });
  counters++;
  myChart.update();
  // client.end()
}
const ctx = document.getElementById('myChart');
const myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ["serial"],
            datasets: [{
                label: '# of Votes',
                data: [],
                backgroundColor: styles.color.solids[3],
                borderColor: styles.color.solids[5],
                borderWidth: 1
            }]
        },
        options: {
          maintainAspectRatio: false,
          scaleFontColor: '#fff',
          scales: {
              yAxes: [{
                  ticks: {
                      display: true
                  }
              }],
              xAxes: [{
                  barPercentage: 0.4,
                  ticks: {
                      display: true
                  }
              }]
          }
      }

    });


 
  


client.on("connect", EventoConectar);
client.on("message", EventoMensaje);
//client.on("message", tal);

console.log("Empezando a conectar");
    
    </script>-->
</html>
