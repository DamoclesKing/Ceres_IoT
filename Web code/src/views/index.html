<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.js"></script>
  <meta charset="utf-8" />
  <%- include ("partials/head.html") %>
    <title>
      <%= title %>
    </title>
</head>

<body class="running">
  <%- include ("partials/svg.html") %>
    <%- include ("partials/Sidebar.html") %>

      <section class="page-content">
        <%- include ("partials/navbar.html") %>
          <main>
            <!-- <h1>Monitoreo de Esp32/Ceres_IoT</h1>
          <p>Visualización de estadísticas</p>
          <hr />
          <h2 class="loading">Esperando respuesta de la API...</h2> -->
            <section class="cols-3">
              <figure>
                <p>Nivel de Agua</p>
                <h3>Tanque Principal</h3>
                <canvas id="cylGauge1"></canvas>
              </figure>
              <div>
                <figure class="minfigure">
                  <p>Información del Tanque</p>
                  <h3>Tanque Pricipal</h3>
                  <div class="column">
                    <div class="row">
                      <p>Volumen Total:</p>
                      <p id="totalPricipal"></p>
                    </div>
                    <div class="row">
                      <p>Volumen Liquido: </p>
                      <p id="liquidoPricipal"></p>
                    </div>
                    <div class="row">
                      <p>Estado del tanque: </p>
                      <p id="estadoPricipal"></p>
                    </div>
                  </div>
                </figure>
                <figure class="minfigure">
                  <p>Información del Tanque</p>
                  <h3>Tanque Reserva</h3>
                  <div>
                    <div class="row">
                      <p>Volumen Total: </p>
                      <p id="totalReserva"></p>
                    </div>
                    <div class="row">
                      <p>Volumen Liquido: </p>
                      <p id="liquidoReserva"></p>
                    </div>
                    <div class="row">
                      <p>Estado del tanque: </p>
                      <p id="estadoReserva"></p>
                    </div>
                  </div>
                </figure>
              </div>

              <figure>
                <p>Nivel de Agua</p>
                <h3>Tanque Reserva</h3>
                <canvas id="cylGauge2"></canvas>
              </figure>
            </section>

            <section class="cols-1">
              <figure>
                <p>Gráfico lineal</p>
                <h3>Grafico de Temperatura</h3>
                <canvas id="tempGrafic"></canvas>
              </figure>
            </section>

            <section class="cols-2">
              <figure>
                <p>Nivel de Agua</p>
                <h3>Tanque de Agua Principal</h3>
                <canvas id="humEnv"></canvas>
              </figure>
              <figure>
                <p>Humedad de la Tierra</p>
                <h3>----------</h3>
                <canvas id="humSoil"></canvas>
              </figure>
            </section>
            <section class="cols-1">
              <figure>
                <p>Panel de Control</p>
                <h3>Control de Llenado</h3>

                <div class="inputDiv">
                  <label for="customRange1" class="form-label">Slider de PWM</label>
                  <div class="etiqueta"></div>
                  <input type="range" class="form-range" id="input3" value="0" min="0" max="255" autocomplete="off">
                </div>
                <div class="inputDiv">
                  <label for="customRange1" class="form-label">LED</label>
                  <label class="switch2">
                    <input type="checkbox" id="myCheck" onclick="myFunction()">
                    <span class="slider round"></span>
                  </label>
                </div>

              </figure>
            </section>
            </div>

          </main>
      </section>
      <%- include ('partials/footer.html') %>
        <script src="/socket.io/socket.io.js"></script>
        <script>
          var socket = io();
          function myFunction() {
            // Get the checkbox
            var checkBox = document.getElementById("myCheck");
            // Get the output text
            // If the checkbox is checked, display the output text
            if (checkBox.checked == true) {
              socket.emit("esp32:luz", 'on')
            } else {
              socket.emit("esp32:luz", 'off')
            }
          }
          var elInput3 = document.querySelector('#input3');
          if (elInput3) {
            var etq = document.querySelector('.etiqueta');
            if (etq) {
              etq.innerHTML = elInput3.value;
              elInput3.addEventListener('input', function () {
                // cambia el valor de la etiqueta (el tooltip) 
                etq.innerHTML = elInput3.value;
                // cambia la posición de la etiqueta (el tooltip) 
                socket.emit("esp32:slider", elInput3.value)
              }, false);

            }
          }

        </script>
        <script>
         // const temp = document.getElementById("tempGrafic")

        </script>
        <script>
          const topic1 = "ceres/sensor/ambiente/temperatura";
          const topic2 = "ceres/sensor/ambiente/humedad";
          const topic3 = "ceres/sensor/distancia";
          const topic6 = "ceres/sensor/planta/humedad-tierra";
          const topic7 = "ceres/tanque/principal/estado";
          const topic8 = "ceres/tanque/auxiliar/estado";
          const topic9 = "ceres/tanque/principal/volumen-total";
          const topic10 = "ceres/tanque/auxiliar/volumen-total";
          const topic11 = "ceres/tanque/principal/volumen-liquido";
          const topic12 = "ceres/tanque/auxiliar/volumen-liquido";
          const topic13 = "ceres/tanque/principal/porcentaje-liquido";
          const topic14 = "ceres/tanque/auxiliar/porcentaje-liquido";
          let counters = 0;
          let uno = 0;
          let dos = 0;
          let tres = 0;
          var socket = io();
          socket.on('esp:temperatura', function (data) {
            temperatureGrafic.data.labels.push(counters);
            temperatureGrafic.data.datasets.forEach((dataset) => {
              dataset.data.push(data.value);
            });
            counters++;
            temperatureGrafic.update();
          })
          socket.on('esp:humedad', function (data) {
            uno = data.value;
            dos = 100 - data.value;
            humiditySoil.data.datasets.forEach((dataset) => {
              dataset.data = [uno, dos];
            });
            humiditySoil.update();
          })
          socket.on('esp:humedad2', function (data) {
            uno = data.value;
            dos = 100 - data.value;
            environmentHumedity.data.datasets.forEach((dataset) => {
              dataset.data = [uno, dos];
            });
            environmentHumedity.update();
          })
          "humEnv"
          socket.on('esp:distancia', function (data) {
            tankWater1.data.datasets.forEach((dataset) => {
              dataset.data = [data.value];
            });
            tankWater1.update();
          })
          socket.on('esp:distancia2', function (data) {
            tankWater2.data.datasets.forEach((dataset) => {
              dataset.data = [data.value];
            });
            tankWater2.update();
          })

          socket.on('esp:temperatura', function (data) {
            var dato = document.getElementById("estadoPricipal");
            dato.innerHTML = data.value
          })
          socket.on('esp:temperatura', function (data) {
            var dato = document.getElementById("totalPricipal");
            dato.innerHTML = data.value
          })
          socket.on('esp:temperatura', function (data) {
            var dato = document.getElementById("liquidoPricipal" );
            dato.innerHTML =data.value
          })
          socket.on('esp:temperatura', function (data) {
            var dato = document.getElementById("estadoReserva");
            dato.innerHTML = data.value
          })
          socket.on('esp:temperatura', function (data) {
            var dato = document.getElementById("totalReserva");
            dato.innerHTML = data.value
          })
          socket.on('esp:temperatura', function (data) {
            var dato = document.getElementById("liquidoReserva");
            dato.innerHTML = data.value
          })





        </script>
        <script src="js/paint.js"></script>
</body>

</html>